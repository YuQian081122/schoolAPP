# 瀏覽器操作指南 - 環境變數設置

本文檔提供直接在瀏覽器中設置環境變數的詳細步驟，包含所有需要填寫的值。

## 🔧 Vercel 環境變數設置

### 快速連結

直接訪問以下 URL（需要先登入 Vercel）：

```
https://vercel.com/dashboard
```

然後找到您的專案 `schoolAPP` 或相關專案名稱。

### 詳細步驟

#### 步驟 1: 進入專案設置

1. 登入 https://vercel.com/dashboard
2. 在專案列表中，找到並點擊您的專案（可能是 `schoolAPP` 或類似的名稱）
3. 點擊頂部導航欄的 **Settings**（設置）按鈕
4. 在左側選單中，點擊 **Environment Variables**（環境變數）

#### 步驟 2: 添加 RASA_SERVER_URL

1. 點擊 **Add New**（新增）按鈕
2. 填寫以下資訊：

   **Key（鍵）**:
   ```
   RASA_SERVER_URL
   ```

   **Value（值）**:
   ```
   https://rasa-service.zeabur.app
   ```
   ⚠️ **注意**: 請將此 URL 替換為您實際的 Zeabur Rasa 服務 URL

   **Environment（環境）**:
   - ✅ 勾選 **Production**（生產環境）
   - ✅ 勾選 **Preview**（預覽環境）
   - ✅ 勾選 **Development**（開發環境）

3. 點擊 **Save**（保存）

#### 步驟 3: 添加 GEMINI_API_KEY

1. 再次點擊 **Add New**（新增）按鈕
2. 填寫以下資訊：

   **Key（鍵）**:
   ```
   GEMINI_API_KEY
   ```

   **Value（值）**:
   ```
   [在此貼上您的 Gemini API Key]
   ```
   ⚠️ **注意**: 
   - 從 https://aistudio.google.com/app/apikey 獲取
   - 只會顯示一次，請妥善保存

   **Environment（環境）**:
   - ✅ 勾選所有環境（Production、Preview、Development）

3. 點擊 **Save**（保存）

#### 步驟 4: 添加 GEMINI_MODEL（可選）

1. 點擊 **Add New**（新增）按鈕
2. 填寫以下資訊：

   **Key（鍵）**:
   ```
   GEMINI_MODEL
   ```

   **Value（值）**:
   ```
   gemini-2.0-flash-exp
   ```

   **Environment（環境）**:
   - ✅ 勾選所有環境

3. 點擊 **Save**（保存）

#### 步驟 5: 重新部署

1. 返回專案主頁（點擊專案名稱）
2. 點擊 **Deployments**（部署）標籤
3. 找到最新的部署記錄
4. 點擊右側的 **⋯**（三個點）選單
5. 選擇 **Redeploy**（重新部署）
6. 確認重新部署

---

## 🚀 Zeabur 環境變數設置

### 快速連結

直接訪問以下 URL（需要先登入 Zeabur）：

```
https://zeabur.com/dashboard
```

### Zeabur Rasa 服務環境變數

#### 步驟 1: 進入 Rasa 服務

1. 登入 https://zeabur.com/dashboard
2. 選擇您的專案
3. 在服務列表中，找到 **Rasa 服務**（或您命名的服務）
4. 點擊服務卡片進入服務詳情頁
5. 點擊頂部導航欄的 **Variables**（環境變數）標籤

#### 步驟 2: 添加 SUPABASE_MODEL_URL

1. 點擊 **+ Add Variable**（新增變數）按鈕
2. 填寫以下資訊：

   **Key（鍵）**:
   ```
   SUPABASE_MODEL_URL
   ```

   **Value（值）**:
   ```
   https://[您的專案ID].supabase.co/storage/v1/object/public/rasa-models/[模型檔案名稱].tar.gz
   ```
   ⚠️ **注意**: 
   - 從 Supabase Storage 獲取（見下方 Supabase 設置步驟）
   - 格式範例：`https://abcdefghijklmnop.supabase.co/storage/v1/object/public/rasa-models/20251219-011229-humble-muenster.tar.gz`

3. 點擊 **Save**（保存）或 **Add**（新增）

#### 步驟 3: 驗證部署

1. 點擊 **Logs**（日誌）標籤
2. 查看部署日誌，應該看到：
   ```
   📥 檢測到 SUPABASE_MODEL_URL，準備從 Supabase Storage 下載模型
   ✅ 模型從 Supabase Storage 下載成功
   ```

### Zeabur Action Server 環境變數

#### 步驟 1: 進入 Action Server 服務

1. 在專案頁面中，找到 **Action Server 服務**
2. 點擊服務卡片進入服務詳情頁
3. 點擊 **Variables**（環境變數）標籤

#### 步驟 2: 添加 GEMINI_API_KEY

1. 點擊 **+ Add Variable**（新增變數）按鈕
2. 填寫以下資訊：

   **Key（鍵）**:
   ```
   GEMINI_API_KEY
   ```

   **Value（值）**:
   ```
   [與 Vercel 相同的 Gemini API Key]
   ```

3. 點擊 **Save**（保存）

#### 步驟 3: 獲取 Action Server URL

1. 點擊 **Settings**（設置）標籤
2. 找到 **Domains**（域名）區塊
3. 複製顯示的 URL（例如：`https://rasa-action-server-xxx.zeabur.app`）
4. 這個 URL 會自動設置為 `ACTION_SERVER_URL` 環境變數

---

## 📦 Supabase Storage 設置

### 快速連結

```
https://supabase.com/dashboard
```

### 步驟 1: 創建專案

1. 訪問 https://supabase.com
2. 點擊 **Start your project**（開始您的專案）
3. 使用 GitHub 帳號登入（推薦）
4. 填寫專案資訊：
   - **Name**: `school-app-storage`（或您喜歡的名稱）
   - **Database Password**: 設置強密碼（請記住）
   - **Region**: 選擇 `Southeast Asia (Singapore)` 或離您最近的區域
5. 點擊 **Create new project**
6. 等待專案初始化（約 2-3 分鐘）

### 步驟 2: 創建 Storage Bucket

1. 在左側選單中，點擊 **Storage**（存儲）
2. 點擊 **New bucket**（新建儲存桶）按鈕
3. 填寫表單：
   - **Name**: `rasa-models`
   - **Public bucket**: ✅ **勾選此選項**（非常重要！）
4. 點擊 **Create bucket**（創建儲存桶）

### 步驟 3: 上傳模型檔案

1. 點擊創建的 bucket（`rasa-models`）
2. 點擊 **Upload file**（上傳檔案）按鈕
3. 選擇您的模型檔案：
   - `rasa/models/20251219-011229-humble-muenster.tar.gz`
   - 或最新的模型檔案
4. 等待上傳完成（根據檔案大小，可能需要幾分鐘）

### 步驟 4: 獲取公開 URL

1. 在檔案列表中，點擊上傳的模型檔案
2. 在檔案詳情頁面中，找到 **Public URL**（公開 URL）
3. 點擊 **Copy**（複製）按鈕
4. URL 格式範例：
   ```
   https://abcdefghijklmnop.supabase.co/storage/v1/object/public/rasa-models/20251219-011229-humble-muenster.tar.gz
   ```
5. **複製此 URL 並貼到 Zeabur 的 SUPABASE_MODEL_URL 環境變數中**

---

## 🔗 獲取 Gemini API Key

### 快速連結

```
https://aistudio.google.com/app/apikey
```

### 步驟

1. 訪問 https://aistudio.google.com/app/apikey
2. 使用 Google 帳號登入
3. 點擊 **Create API Key**（創建 API 金鑰）按鈕
4. 選擇 Google Cloud 專案（或創建新專案）
5. API Key 會自動生成
6. **立即複製並保存**（只會顯示一次！）
7. 將此 API Key 設置到：
   - Vercel: `GEMINI_API_KEY`
   - Zeabur Action Server: `GEMINI_API_KEY`

---

## ✅ 驗證設置

### 驗證 Vercel

訪問以下 URL（替換為您的實際域名）：

```
https://your-app.vercel.app/api/rasa/status
```

應該返回 Rasa 服務狀態，而不是 `{"status": "no_server"}`

### 驗證 Zeabur Rasa 服務

訪問（替換為您的實際 URL）：

```
https://rasa-service.zeabur.app/status
```

應該返回 Rasa 服務狀態 JSON

### 驗證 Zeabur Action Server

訪問（替換為您的實際 URL）：

```
https://rasa-action-server-xxx.zeabur.app/health
```

應該返回 `{"status": "ok"}`

### 驗證 Supabase Storage

在瀏覽器中直接訪問模型檔案的 Public URL，應該能夠下載檔案。

---

## 📋 環境變數檢查清單

### Vercel
- [ ] `RASA_SERVER_URL` = `https://rasa-service.zeabur.app`（替換為實際 URL）
- [ ] `GEMINI_API_KEY` = `[您的 API Key]`
- [ ] `GEMINI_MODEL` = `gemini-2.0-flash-exp`（可選）

### Zeabur Rasa 服務
- [ ] `SUPABASE_MODEL_URL` = `[從 Supabase 複製的 URL]`
- [ ] `ACTION_SERVER_URL` = `[自動設置]`

### Zeabur Action Server
- [ ] `GEMINI_API_KEY` = `[與 Vercel 相同]`

---

## 🆘 需要幫助？

如果遇到問題，請檢查：
1. 所有 URL 是否正確（包含 `https://`）
2. API Key 是否正確複製（沒有多餘空格）
3. Supabase bucket 是否設置為公開
4. 服務是否已重新部署

---

**最後更新**: 2025-12-25
