# 大型檔案上傳指引

本文檔列出需要手動上傳到部署平台的大型檔案，以及上傳方法。

## 需要手動上傳的檔案

### 1. Rasa 訓練模型檔案

**檔案位置**: `rasa/models/*.tar.gz`

**檔案清單**:
- `rasa/models/20251218-233623-magnetic-putty.tar.gz`
- `rasa/models/20251219-011229-humble-muenster.tar.gz`
- `rasa/models/temp_backup/nlu-model-backup.tar.gz`（備份檔案，可選）

**檔案大小**: 通常為 50-200 MB（每個檔案）

**處理方式**: 
- ✅ 已在 `.gitignore` 中排除，不會推送到 GitHub
- ✅ 使用 Supabase Storage 或其他外部存儲服務存儲
- ✅ 在 Zeabur 環境變數中設置 `SUPABASE_MODEL_URL` 指向模型檔案 URL

### 2. 圖片檔案（可選）

**檔案位置**: `photos/*.jpg`

**檔案清單**:
- `photos/zongsan1.jpg`
- `photos/zongsan2.jpg`
- `photos/zongsan3.jpg`

**檔案大小**: 通常為 100 KB - 5 MB（每個檔案）

**處理方式**:
- 如果檔案總大小 < 10 MB，可以直接推送到 GitHub
- 如果檔案過大（> 1 MB 每個），考慮使用 CDN 或外部存儲
- 可以壓縮圖片以減少檔案大小

## 上傳方法

### 方法 1: Supabase Storage（推薦用於模型檔案）

#### 步驟 1: 創建 Supabase 專案

1. 訪問 https://supabase.com
2. 登入並創建新專案
3. 等待專案初始化完成

#### 步驟 2: 創建 Storage Bucket

1. 在 Supabase Dashboard 中，進入 **Storage** 選項卡
2. 點擊 **New bucket**
3. 輸入 bucket 名稱（例如：`rasa-models`）
4. 設置為 **Public bucket**（允許公開訪問）
5. 點擊 **Create bucket**

#### 步驟 3: 上傳模型檔案

1. 在 Storage 中選擇創建的 bucket
2. 點擊 **Upload file**
3. 選擇模型檔案（例如：`20251219-011229-humble-muenster.tar.gz`）
4. 等待上傳完成

#### 步驟 4: 獲取公開 URL

1. 點擊上傳的檔案
2. 複製 **Public URL**（格式：`https://your-project.supabase.co/storage/v1/object/public/bucket-name/filename.tar.gz`）

#### 步驟 5: 設置 Zeabur 環境變數

1. 在 Zeabur Dashboard 中，進入 Rasa 服務
2. 進入 **Environment Variables** 選項卡
3. 添加環境變數：
   - **Key**: `SUPABASE_MODEL_URL`
   - **Value**: 複製的 Public URL
4. 保存並重新部署

### 方法 2: GitHub Releases（備用方案）

如果 Supabase 不可用，可以使用 GitHub Releases：

#### 步驟 1: 創建 Release

1. 在 GitHub 倉庫中，點擊 **Releases**
2. 點擊 **Create a new release**
3. 輸入版本號（例如：`v1.0.0`）
4. 上傳模型檔案作為附件
5. 發布 Release

#### 步驟 2: 獲取下載 URL

1. 在 Release 頁面中，找到模型檔案
2. 右鍵點擊檔案，選擇 **Copy link address**
3. 獲得的 URL 格式：`https://github.com/username/repo/releases/download/v1.0.0/filename.tar.gz`

#### 步驟 3: 設置 Zeabur 環境變數

1. 在 Zeabur Dashboard 中，進入 Rasa 服務
2. 進入 **Environment Variables** 選項卡
3. 添加環境變數：
   - **Key**: `MODEL_DOWNLOAD_URL`
   - **Value**: 複製的 GitHub Release URL
4. 保存並重新部署

### 方法 3: Zeabur Volume（適用於持久化存儲）

如果需要在 Zeabur 中使用 Volume 存儲模型：

#### 步驟 1: 創建 Volume

1. 在 Zeabur Dashboard 中，進入專案設置
2. 點擊 **Volumes**
3. 點擊 **Create Volume**
4. 輸入 Volume 名稱（例如：`rasa-models`）
5. 設置大小（建議至少 1 GB）

#### 步驟 2: 掛載 Volume 到服務

1. 在 Rasa 服務設置中，進入 **Volumes** 選項卡
2. 點擊 **Mount Volume**
3. 選擇創建的 Volume
4. 設置掛載路徑（例如：`/volume/models`）

#### 步驟 3: 上傳模型檔案

1. 使用 Zeabur CLI 或通過 SSH 連接到服務
2. 將模型檔案複製到 Volume 掛載路徑
3. 或者使用 Zeabur 的檔案上傳功能（如果可用）

#### 步驟 4: 設置環境變數

1. 在 Zeabur Dashboard 中，進入 Rasa 服務
2. 進入 **Environment Variables** 選項卡
3. 添加環境變數：
   - **Key**: `VOLUME_MODEL_PATH`
   - **Value**: `/volume/models/filename.tar.gz`（實際檔案路徑）
4. 保存並重新部署

## 圖片檔案處理

### 如果圖片檔案較小（< 1 MB）

可以直接推送到 GitHub，Vercel 會自動提供靜態檔案服務。

### 如果圖片檔案較大（> 1 MB）

#### 選項 1: 使用 CDN

1. 上傳圖片到 CDN 服務（如 Cloudinary、Imgur 等）
2. 在程式碼中使用 CDN URL 而不是本地路徑

#### 選項 2: 壓縮圖片

1. 使用圖片壓縮工具（如 TinyPNG、Squoosh）
2. 壓縮後再推送到 GitHub

#### 選項 3: 使用 Supabase Storage

1. 創建一個新的 Storage bucket（例如：`photos`）
2. 上傳圖片到 bucket
3. 在程式碼中使用 Supabase Storage URL

## 驗證上傳

### 驗證模型檔案上傳

1. **檢查 URL 可訪問性**
   - 在瀏覽器中訪問模型檔案的 URL
   - 應該能夠下載檔案

2. **檢查 Zeabur 部署日誌**
   - 在 Zeabur Dashboard 中查看 Rasa 服務的部署日誌
   - 應該看到類似以下訊息：
     ```
     📥 檢測到 SUPABASE_MODEL_URL，準備從 Supabase Storage 下載模型
     ✅ 模型從 Supabase Storage 下載成功: models/filename.tar.gz
     ```

3. **檢查服務狀態**
   - 訪問 `https://rasa-service.zeabur.app/status`
   - 應該返回正常的服務狀態

### 驗證圖片檔案上傳

1. **檢查圖片可訪問性**
   - 在瀏覽器中訪問圖片 URL
   - 應該能夠顯示圖片

2. **檢查前端顯示**
   - 訪問前端頁面
   - 檢查圖片是否正常顯示

## 注意事項

1. **檔案大小限制**:
   - GitHub: 單檔案限制 100 MB
   - Supabase Storage: 根據方案不同，通常為 1-5 GB
   - Zeabur Volume: 根據方案不同，通常為 1-10 GB

2. **安全性**:
   - 模型檔案包含訓練數據，建議使用私有存儲
   - 如果使用公開存儲，確保 URL 不容易被猜測

3. **成本**:
   - Supabase Storage: 免費方案通常有 1 GB 限制
   - Zeabur Volume: 根據使用量收費
   - 選擇適合您需求的方案

4. **備份**:
   - 建議保留模型檔案的本地備份
   - 定期備份到多個位置

## 故障排除

### 模型檔案下載失敗

1. **檢查 URL 是否正確**
   - 確認 URL 格式正確
   - 確認 URL 可以公開訪問

2. **檢查網路連接**
   - 確認 Zeabur 服務可以訪問外部 URL
   - 檢查防火牆設置

3. **檢查檔案大小**
   - 確認檔案大小在限制範圍內
   - 如果檔案過大，考慮壓縮或分割

### 圖片檔案無法顯示

1. **檢查 URL 是否正確**
   - 確認圖片 URL 格式正確
   - 確認圖片可以公開訪問

2. **檢查 CORS 設置**
   - 確認圖片服務允許跨域訪問
   - 檢查瀏覽器控制台的錯誤訊息

---

**最後更新**: 2025-12-25  
**狀態**: ✅ 完成
