# 錯誤診斷與解決方案

## 📋 錯誤摘要

您看到的錯誤有兩種類型：

### 1. ❌ 503 錯誤（需要修復）

```
rasa/status:1 Failed to load resource: the server responded with a status of 503 ()
```

**問題說明：**
- Vercel API route (`/api/rasa/status`) 無法連接到 Zeabur 上的 Rasa 服務器
- 這會導致 AI 聊天功能無法使用

**可能原因：**
1. Zeabur 上的 Rasa 服務未運行或已崩潰
2. Vercel 環境變數 `RASA_SERVER_URL` 未設置或設置錯誤
3. Zeabur 服務正在重啟或維護中
4. 網絡連接問題

### 2. ⚠️ ERR_CONNECTION_REFUSED（可忽略）

```
127.0.0.1:7242/ingest/... Failed to load resource: net::ERR_CONNECTION_REFUSED
```

**問題說明：**
- 這是開發時的調試日誌系統嘗試連接到本地端口 7242
- 該服務未運行，但不影響應用核心功能
- 所有調試請求都被 `.catch(()=>{})` 捕獲，不會中斷應用運行

## 🔧 解決步驟

### 步驟 1：檢查 Zeabur Rasa 服務狀態

1. 訪問 [Zeabur Dashboard](https://dash.zeabur.com)
2. 找到您的 Rasa 服務
3. 檢查：
   - ✅ 服務是否正在運行（Running）
   - ✅ 是否有錯誤日誌
   - ✅ 服務 URL 是否正確

### 步驟 2：檢查 Vercel 環境變數

1. 訪問 [Vercel Dashboard](https://vercel.com/dashboard)
2. 進入您的專案
3. 前往 **Settings** → **Environment Variables**
4. 確認：
   - 變數名：`RASA_SERVER_URL`
   - 值：`https://your-rasa-service.zeabur.app`（您的實際 Zeabur URL）
   - 環境：Production, Preview, Development（所有環境都應設置）

### 步驟 3：測試 Zeabur Rasa 服務

直接在瀏覽器中訪問：
```
https://your-rasa-service.zeabur.app/status
```

**預期結果：**
- 應該返回 JSON 格式的 Rasa 狀態信息
- 如果返回 502/503/504，表示服務未運行或正在啟動

### 步驟 4：重啟 Zeabur 服務（如果需要）

如果服務未運行：
1. 在 Zeabur Dashboard 中進入 Rasa 服務
2. 點擊 **Restart** 或 **Redeploy**
3. 等待服務重新啟動（通常需要 1-2 分鐘）
4. 查看日誌確認服務正常啟動

### 步驟 5：驗證修復

服務重啟後：
1. 再次訪問 `https://your-rasa-service.zeabur.app/status`
2. 確認返回正常狀態
3. 刷新您的應用頁面
4. 檢查瀏覽器控制台，503 錯誤應該消失

## 🧹 可選：移除調試日誌（減少控制台噪音）

如果您想移除調試日誌以減少控制台錯誤訊息，可以：

1. **選項 A：禁用調試日誌**（推薦）
   - 在代碼中搜索 `#region agent log` 和 `#endregion`
   - 註釋掉這些調試代碼塊

2. **選項 B：完全移除調試代碼**
   - 移除所有包含 `127.0.0.1:7242` 的代碼行
   - 這需要修改 `ai-chat.js` 文件

**注意：** 調試日誌不影響功能，只是會在控制台顯示錯誤。如果不想看到這些錯誤，可以選擇移除。

## 📊 預期結果

修復後應該看到：
- ✅ 沒有 503 錯誤
- ✅ `/api/rasa/status` 返回正常狀態
- ✅ AI 聊天功能可以正常使用
- ⚠️ ERR_CONNECTION_REFUSED 可能仍然存在（如果不移除調試代碼），但不影響功能

## 🔍 快速診斷命令

在瀏覽器控制台執行以下命令來診斷問題：

```javascript
// 檢查 Rasa URL 配置
fetch('/api/rasa/status')
  .then(r => r.json())
  .then(data => console.log('Rasa 狀態:', data))
  .catch(err => console.error('連接失敗:', err));
```

## 📞 需要幫助？

如果問題持續存在，請檢查：
1. Zeabur 服務日誌中的錯誤訊息
2. Vercel 部署日誌
3. 網絡連接是否正常
4. 環境變數是否正確設置

